name: Env, Step Outputs & Job Outputs Practice

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    # ðŸ”¹ Job-level environment variables
    env:
      APP_NAME: demo-app

    outputs:
      build_version: ${{ steps.version_step.outputs.version }}
      image_tag: ${{ steps.tag_step.outputs.tag }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # ðŸ”¹ Runtime environment variable
      - name: Set runtime environment variable
        run: |
          echo "BUILD_DATE=$(date +'%Y-%m-%d')" >> $GITHUB_ENV

      - name: Use runtime environment variable
        run: |
          echo "Build date is: $BUILD_DATE"
          echo "App name is: $APP_NAME"

      # ðŸ”¹ Step output example
      - name: Generate version
        id: version_step
        run: |
          VERSION="1.0.${{ github.run_number }}"
          echo "version=$VERSION" >> $GITHUB_OUTPUT

      - name: Show step output
        run: |
          echo "Generated version: ${{ steps.version_step.outputs.version }}"

      # ðŸ”¹ Another step output
      - name: Generate image tag
        id: tag_step
        run: |
          TAG="${APP_NAME}:${{ steps.version_step.outputs.version }}"
          echo "tag=$TAG" >> $GITHUB_OUTPUT

      - name: Show image tag
        run: |
          echo "Image tag is: ${{ steps.tag_step.outputs.tag }}"

  deploy:
    runs-on: ubuntu-latest
    needs: build

    steps:
      - name: Use job outputs
        run: |
          echo "Deploying version: ${{ needs.build.outputs.build_version }}"
          echo "Deploying image: ${{ needs.build.outputs.image_tag }}"
